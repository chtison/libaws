ServiceToken_CognitoUserPool: "!ImportValue CUSTOM-Cognito-User-Pool"
ServiceToken_CognitoUserPoolClient: "!ImportValue CUSTOM-Cognito-User-Pool-Client"

CognitoUserPoolName: API-COGNITO

Lambdas:
    Echo:
        Zip: echo.zip
        Permissions: [{Principal: apigateway.amazonaws.com}]

    UserInfoGET:
        Zip: user.info/get.zip
        Permissions: [{Principal: apigateway.amazonaws.com}]
        Policies:
            - Action: ["dynamodb:GetItem"]
              Resource: "!Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${DynamoTableUsers}'"
        Environment: {DYNAMODB_TABLE_NAME_Users: "!Ref DynamoTableUsers"}

    UserInfoPOST:
        Zip: user.info/post.zip
        Permissions: [{Principal: apigateway.amazonaws.com}]
        Policies:
            - Action: ["dynamodb:UpdateItem"]
              Resource: "!Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${DynamoTableUsers}'"
        Environment: {DYNAMODB_TABLE_NAME_Users: "!Ref DynamoTableUsers"}

    UserInfoPUT:
        Zip: user.info/put.zip
        Permissions: [{Principal: apigateway.amazonaws.com}]
        Policies:
            - Action: ["dynamodb:UpdateItem"]
              Resource: "!Sub 'arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/${DynamoTableUsers}'"
        Environment: {DYNAMODB_TABLE_NAME_Users: "!Ref DynamoTableUsers"}

Api:
    ApiTitle: "!Ref AWS::StackName"
    UserPools:
        - Name: UserPool1
          Arn: "!GetAtt CognitoUserPool.Arn"
    Paths:
        - Path: /
          Methods:
              - Method: x-amazon-apigateway-any-method
                LambdaArn: "!GetAtt FunctionEcho.Arn"
                UserPoolName: UserPool1
        - Path: /user
          Methods:
              - Method: get
                LambdaArn: "!GetAtt FunctionUserInfoGET.Arn"
                UserPoolName: UserPool1
              - Method: post
                LambdaArn: "!GetAtt FunctionUserInfoPOST.Arn"
                UserPoolName: UserPool1
              - Method: put
                LambdaArn: "!GetAtt FunctionUserInfoPUT.Arn"
                UserPoolName: UserPool1
